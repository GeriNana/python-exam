<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Payment Options</title>
</head>
<body>
    <h1>Payment Options</h1>
    <p>Total: $<span id="total-price">0.00</span></p>

    <button onclick="payOnDelivery()">Pay on Delivery</button>
    <button onclick="payWithPaypal()">Pay with PayPal</button>

    <form id="paypal-form" action="/orders/paypal" method="POST" style="display:none;">
        <input type="hidden" name="total" id="paypal-total">
    </form>

    <script>
        document.addEventListener('DOMContentLoaded', (event) => {
            const basket = JSON.parse(localStorage.getItem('basket'));
            let totalPrice = 0;
            for (const item of Object.values(basket)) {
                totalPrice += item.price * item.quantity;
            }
            document.getElementById('total-price').textContent = totalPrice.toFixed(2);
            document.getElementById('paypal-total').value = totalPrice.toFixed(2);
        });

        function payOnDelivery() {
            fetch('/orders/complete', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ method: 'delivery', basket: JSON.parse(localStorage.getItem('basket')) }),
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('Order placed successfully!');
                    localStorage.removeItem('basket');
                    window.location.href = '/';
                } else {
                    alert('Failed to place order.');
                }
            })
            .catch((error) => {
                console.error('Error:', error);
            });
        }

        function payWithPaypal() {
            document.getElementById('paypal-form').submit();
        }
    </script>
</body>
</html>
