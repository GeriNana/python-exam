<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Menu for {{ restaurant.name }}</title>
    <script>
        let basket = {};
        let totalPrice = 0;

        function addToBasket(dishName, dishPrice) {
            if (basket[dishName]) {
                basket[dishName].quantity += 1;
            } else {
                basket[dishName] = { price: dishPrice, quantity: 1 };
            }
            totalPrice += dishPrice;
            updateBasket();
        }

        function updateBasket() {
            const basketTable = document.getElementById('basket-table-body');
            basketTable.innerHTML = '';
            for (const [dishName, dish] of Object.entries(basket)) {
                const row = document.createElement('tr');
                const nameCell = document.createElement('td');
                nameCell.textContent = dishName + ' x' + dish.quantity;
                const priceCell = document.createElement('td');
                priceCell.textContent = '$' + (dish.price * dish.quantity).toFixed(2);
                row.appendChild(nameCell);
                row.appendChild(priceCell);
                basketTable.appendChild(row);
            }
            document.getElementById('total-price').textContent = '$' + totalPrice.toFixed(2);
        }

        function checkout() {
            localStorage.setItem('basket', JSON.stringify(basket));
            window.location.href = '/orders/checkout';
        }
    </script>
</head>
<body>
    <h1>Menu for {{ restaurant.name }}</h1>
    {% for menu in menus %}
    <h2>{{ menu.restaurant_name }}</h2>
    <img src="{{ menu.image_url }}" alt="Menu Image">
    <p>Minimum Order Amount: ${{ menu.min_order_amount }}</p>
    <p>Average Preparation Time: {{ menu.avg_preparation_time }} minutes</p>

    <h3>Dishes</h3>
    <table border="1">
        <thead>
            <tr>
                <th>Dish Name</th>
                <th>Description</th>
                <th>Price</th>
                <th>Image</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for dish in menu.dishes %}
            <tr>
                <td>{{ dish.name }}</td>
                <td>{{ dish.description }}</td>
                <td>${{ dish.price }}</td>
                <td><img src="{{ dish.image_url }}" alt="Dish Image" width="100"></td>
                <td>
                    <button onclick="addToBasket('{{ dish.name }}', {{ dish.price }})">Order</button>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% endfor %}

    <h2>Basket</h2>
    <table border="1">
        <thead>
            <tr>
                <th>Dish Name</th>
                <th>Price</th>
            </tr>
        </thead>
        <tbody id="basket-table-body">
            <!-- Basket items will be added here by JavaScript -->
        </tbody>
    </table>
    <p>Total: <span id="total-price">$0.00</span></p>
    <button onclick="checkout()">Checkout</button>
</body>
</html>
